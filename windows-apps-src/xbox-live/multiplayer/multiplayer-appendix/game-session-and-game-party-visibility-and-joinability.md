---
title: 游戏会话的可见性和可加入性
author: KevinAsgari
description: 介绍 Xbox Live 游戏会话和游戏派对的可见性和可加入性。
ms.assetid: 39b6dac1-0c6b-4dc1-9fe0-3cb7c471fbab
ms.author: kevinasg
ms.date: 04/04/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Xbox live, xbox, 游戏, uwp, windows 10, xbox one
ms.localizationpriority: low
ms.openlocfilehash: 8e887b55e3d5a0a6796685873dec39b5ddef52bd
ms.sourcegitcommit: 01760b73fa8cdb423a9aa1f63e72e70647d8f6ab
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/24/2018
---
# <a name="game-session-and-game-party-visibility-and-joinability"></a>游戏会话和群体游戏的可见性和可加入性

在 Xbox One 上，游戏会话和游戏派对的*可见性*和*可加入性*设置分别控制对多人游戏体验的访问。 若要为会话加入，以及邀请玩家加入游戏会话和派对提供出色的用户体验，游戏开发人员需要了解这些设置。 本白皮书回顾了可见性与可加入性之间的区别，并讨论了我们建议游戏使用的以为消费者提供最佳多人游戏用户流的特定设置。

## <a name="game-session-visibility"></a>游戏会话的可见性


多人游戏会话目录 (MPSD) 会话访问受两个设置的限制：会话*可见性*和会话*可加入性*。 这些设置可以用来限制 MPSD 级别的会话访问。

访问控制的第一个方面是会话可见性。 会话可见性是在会话创建时设置的常量。 它通常在会话模板中定义，并确定哪类用户具有对会话的读写访问权限。 可见性设置使用的值包括：

-   *开放 - *所有用户均可以读取和写入会话。

-   *可见 - *所有用户均可以读取会话，但只有加入和保留的玩家可以写入会话。

-   *私人 - *只有加入和保留的玩家可以读取或写入会话。

> **注意：** 将可见性设置为“私人”可能需要重试受邀请玩家发出的 **join()** 调用。 如果邀请通过平台 UI 发送，它可以由另一个玩家接收（在该玩家被保留在会话中之前）。 此争用情况可能会导致受邀请玩家的 **join()** 调用失败，因为私人或可见会话需要为加入玩家保留。
>
> 如果保留不存在，将在会话中引发访问错误 (HTTP/403)。 受邀请的玩家然后将不得不重试 **join()** 操作，但重试频率不应该超过每五秒一次。 我们建议游戏将会话可见性设置为“开放”，以避免玩家的加入流程中出现争用情况。

## <a name="game-session-joinability"></a>游戏会话的可加入性


访问控制的第二个方面是可加入性。 它可以在会话生存期内动态设置，并确定哪类用户可以加入会话。 会话可加入性使用的值包括：

-   *无*（默认值）- 对于可以加入会话的人没有限制。

-   *本地* - 仅本地用户可以加入会话。

-   *已关注 -* 仅本地用户和其他会话成员关注的用户可以在不保留的情况下加入会话。

会话主机或仲裁程序可以通过可加入性设置创建私人会话：将可加入性设置为“本地”或“已关注”将限制对游戏会话的访问，使其变为私人会话。

此外，会话主机或仲裁程序应跟踪会话的可加入性，以便在需要时可以在主机级别拒绝较早的会话邀请。 例如，如果受邀请的玩家在会话已满前未到达并加入会话和/或派对，主机或仲裁程序可以指示任何加入玩家会话已被锁定，他们需要自动离开会话和/或派对。

**注意：** 游戏会话可加入性不会反映在“派对”应用 UI 中。 即使可加入性受限，“派对”应用邀请 UI 和 **ShowSendInvitesAsync** 也会允许发送游戏会话邀请。

## <a name="game-party-joinability"></a>游戏派对可加入性


除了控制 MPSD 会话外，游戏还可以控制游戏派对可加入性的状态。 此设置可以用来在派对级别限制游戏派对的访问。

在创建游戏派对后，派对可加入性可以动态更改。 游戏派对的可加入性状态反映在派对邀请 UI 中。 它可以被设置为：

-   *仅邀请 - *此设置需要有加入游戏派对的邀请。

-   *可由好友加入*（默认值）*- *此设置需要加入游戏派对的玩家拥有好友关系（若要加入某个派对，派对的成员必须关注加入的玩家）。

可加入性可用于创建“仅邀请”游戏派对。 若要限制对派对的访问，并且需要玩家已收到加入邀请，应将可加入性设置为“仅邀请”。

**注意：** 派对的可加入性不会影响会话的可加入性，但派对可加入性反映在“派对”应用 UI 中。 玩家可以在游戏之外的“派对”应用中手动更改派对可加入性。

## <a name="recommendations"></a>建议


下面的建议适用于最常见的作品场景。 如果可能，游戏应遵循这些设置，并且应使用游戏内逻辑来进行有关新用户是否被准许进入会话的最终的权威决定。

### <a name="recommended-game-session-visibility-open"></a>建议的游戏会话可见性为：开放

开放游戏会话不需要玩家保留，因而简化了邀请流程。 会话主机或仲裁程序不会在发送邀请后在会话文档中保留玩家。 相反，会话主机或仲裁程序仅在本地跟踪受邀请的玩家。 这让玩家可以立即连接到主机，并确定他们是应该加入会话、被拒绝，还是应该等待（如果支持等待玩家）。 仲裁程序或主机是最终授权和响应，指示新成员留在会话中还是离开。

**注意：** 这将需要受邀请的玩家启动游戏并在进行最终决定前连接到主机或仲裁程序。 如果会话已满或邀请被拒绝，可以接受向用户显示一条错误消息。

> **注意：** 若要建立与主机或仲裁程序的连接，需要安全设备地址。 会话中的 **HostDeviceToken** 应用于指示哪个会话成员是会话当前的主机或仲裁程序，以及受邀请的玩家应该连接到哪个安全设备地址。

### <a name="recommended-game-session-joinability-default-not-set"></a>建议的游戏会话可加入性为：默认（*未设置*）

目前，游戏会话的可加入性不影响“派对”应用 UI，且不向用户提供。 若要简化游戏流，游戏可加入性应保留为默认值，并且所有加入授权均应通过仲裁程序或主机处理。

### <a name="recommended-game-party-joinability"></a>建议的游戏派对可加入性

游戏派对可加入性取决于游戏尝试向用户提供的会话类型。 两个场景为：

-   开放游戏 - 对于开放游戏，游戏派对可加入性应保留为默认值：可由好友加入。 这允许好友加入游戏派对（通过扩展游戏会话），无需邀请。

-   私人游戏 - 对于私人或封闭游戏，游戏派对可加入性应设置为“仅邀请”。 这将限制没有邀请的其他玩家加入派对（通过扩展游戏会话）。

**注意**：玩家可以通过“派对”应用手动更改游戏会话的可加入性。

对于两个游戏类型，仲裁程序或主机仍应保留最终权限，以确定谁被接受加入会话。 这可以应对将游戏流从开放切换为私人时发生的任何争用情况。 如果仲裁程序/主机拒绝玩家，被拒绝的游戏实例应将玩家从会话中删除，并应显示游戏内 UI 以允许玩家离开派对。

### <a name="maximum-session-size"></a>最大会话大小

会话的最大成员大小可用来限制加入游戏会话的玩家数量。 但是，此限制可能会导致空位在某些断开连接场景中仍显示为已满。 例如，如果玩家由于网络或电源故障而断开连接，延迟不会立即反映在会话中。 成员会在状态服务检测到断开连接（最长 20 秒）后立即被设置为非活动，然后玩家将在非活动超时到期后被删除。

相比之下，使用检测信号检测断开连接的对等网格通常能在两到三秒内得知断开连接，因此可以立即打开玩家空位。 但是，仲裁程序或主机无法删除其他成员。

若要解决此问题，应始终将会话的最大成员大小设置为高于游戏实际支持的玩家最大数。 例如，如果玩家数是 8，作品应将最大会话大小设置为 12。 通过这种方式，即使旧玩家尚未超时，新玩家也可以加入。仲裁程序或主机确定会话是否已满，然后设置将确定新玩家是否仍可以加入的自定义会话属性（**IsFull**：“true”）。 这允许加入玩家快速检查会话是否可以加入。

仲裁程序或主机还应该维护指示哪些成员（按索引）已经超时的自定义属性（例如，**TimedOutPlayers**：“3, 5, 9”）。 这让新玩家可以正确识别当前的会话成员。

### <a name="notifying-waiting-players"></a>通知等待玩家

作品可以通过除管理游戏派对外还管理排队的玩家列表来支持等待玩家。 当玩家连接到主机且游戏会话已满时，玩家将被添加到主机上的内部等待列表中。 排队的玩家未加入游戏会话，但仍在游戏派对内。 为了最大程度降低网络流量，等待玩家此时将断开与主机的连接。

当游戏会话中的空位为等待玩家开放时，仲裁程序或主机通过调用 **AddMemberReservation** 方法来为玩家添加保留。 此时，等待玩家还不知道此保留，因此仲裁程序或主机必须调用 **PullReservedPlayersAsync** 方法。 这会导致所有保留的玩家收到 UI toast 或 **GameSessionReady** 通知，具体取决于 toast 配置和作品的焦点状态。 在收到此通知时，新玩家将重新连接到主机并加入会话。

或者，玩家可以保持与主机的连接，并在主机提示玩家有空位时加入会话。 但是，在此流程中，作品之外的 UI toast 无法显示。

**注意：** 如果游戏被挂起和/或终止，玩家将被自动从游戏派对中删除，且不会再收到其他通知。

<a name="client-multiplayer-flow"></a>客户端多人游戏流
-----------------------

![](../../images/whitepapers/gamesessionvisibility_image1.png)
![](../../images/whitepapers/gamesessionvisibility_image2.png)

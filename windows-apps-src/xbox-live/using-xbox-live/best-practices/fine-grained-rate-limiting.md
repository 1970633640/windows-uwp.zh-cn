---
title: Xbox Live 细化速率限制
author: KevinAsgari
description: 了解 Xbox Live 细化速率限制的工作方式，以及如何防止你的作品受到速率限制。
ms.assetid: ceca4784-9fe3-47c2-94c3-eb582ddf47d6
ms.author: kevinasg
ms.date: 04/04/2017
ms.topic: article
ms.prod: windows
ms.technology: uwp
keywords: Xbox live, xbox, 游戏, uwp, windows 10, xbox one, 节流, 速率限制
ms.localizationpriority: low
ms.openlocfilehash: 41b31504cfcdd3721dda8389d48b8e0cfb1d2a01
ms.sourcegitcommit: 6618517dc0a4e4100af06e6d27fac133d317e545
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2018
---
# <a name="xbox-live-fine-grained-rate-limiting"></a>Xbox Live 细化速率限制

## <a name="introduction"></a>简介


本文提供 Xbox Live 细化速率限制的概述。 除了概述何谓速率限制以外，本文还致力于帮助你确定是否受到了限制，以及在受到限制时可以选择使用哪些工具和资源。

## <a name="terminology-guide"></a>术语指南

| 术语         | 定义                                                  |
|--------------|-----------------------------------------------------------------------------
| FGRL         | 细化速率限制                                                  
| XSAPI        | Xbox 服务应用程序编程接口                                 
| CU           | 内容更新                                                              
| 突增        | 表示在短时间内收到大量请求          
| 持续      | 表示在一段时间内持续收到大量调用
| 用户 + 作品 | 表示将用户和作品配对成一个实体                    


## <a name="xbox-live-fine-grained-rate-limiting"></a>Xbox Live 细化速率限制

**细化速率限制**旨在倡导在不同的作品中**公平使用**共享的 Xbox Live 资源。 该解决方案与大多数传统的限制系统一样，这些系统通过一项服务来使实体在给定时间段内提出一定数量的请求。

达到服务规定的限制的实体随后将会进入拒绝状态，其中来自实体的所有传入请求都将被转移。 仅当给定的时间段到期（这会导致实体关联计数重置）时，实体才能够退出此状态。

细化速率限制使用与上述机制相同的核心机制，然而与跟踪一个实体不同，FGRL 将跟踪**用户和作品**的组合，并且会将关联计数与**两项**不同的**限制**而不是一项限制进行比较。 对每项服务实施 FGRL 双重限制意味着 GameClips 的请求计数不会影响 Presence 的请求计数。 以下部分将更详细地介绍用户和作品配对、双重限制以及 HTTP 429 限制响应对象。

## <a name="fair-usage"></a>公平使用

Xbox Live 坚信无论每个用户在玩什么游戏/应用，他/她都应该拥有始终如一的高品质体验。 FGRL 旨在满足以下场景的要求：

开发人员 A 刚刚发布了一款遵循所有 Xbox live 最佳实践的作品，可确保以最佳方式使用服务，而开发人员 B 刚刚也发布了一款包含未知 bug 的作品。 此 bug 导致作品和每个用户向 Presence 发送垃圾邮件，从而导致服务不堪重负。 即使是开发人员 B 的 bug 导致出现该问题，该服务的速度也会减慢并最终停止，这将导致开发人员 A 的用户体验中断。 如果已实施 FGRL，该服务将能够停止接收来自错误行为作品的请求，从而允许其向开发人员 A 的作品提供公平的资源份额。

## <a name="title-and-user-granularity"></a>作品和用户粒度

所选的作品和用户对于确保公平使用 Xbox Live 资源至关重要。 仅跟踪用户将创建一个场景，其中用户体验将受制于每个作品的集成情况。 例如，大部分作品都在使用人脉服务，对于此示例，已针对人脉服务设置细化速率限制，它允许在 5 分钟内提出不超过 100 次请求。 如果用户要玩在 1 分钟内提出 100 次请求的游戏，那么这会超出限制，用户将无法再向人脉服务提出任何请求；假设在同一时段内，用户随后返回到主屏幕并单击其好友列表：由于用户已经超出了限制，好友列表调用将失败，直到 5 分钟间隔过去为止，即使主屏幕不负责将用户置于受限状态，也会出现这种情况。

仅基于作品的限制也会产生同样不公平的结果。 为每个作品设置限制将会忽略作品的热门程度，并且将按照“先到先得”的原则处理请求，直到达到限制为止。

用户和作品的配对可确保每个作品使用的资源不超过为大量活跃用户指定的相应资源量，同时还会为每个用户提供一致的资源份额。

![](../../images/FGRL.png)

上图显示了有关如何处理请求的高级视图。 首先生成请求，所需的服务随后会接收该请求。 在收到请求后，系统将进行检查，以查看用户和作品对该服务进行访问的总次数。 如果请求未超出限制，则系统将按照正常方式进行处理。 如果发现该请求已达到或超出限制，则服务将删除它，并改为返回 429 响应代码。 该响应将指明必须经过多长时间才能处理用户和作品请求。

## <a name="burst-and-sustain-limits"></a>突增和持续限制

通常，速率限制包含对每个端点的一个限制，系统将在给定时段内对其进行跟踪。 此时段表示对实体请求计数进行跟踪的时间。 当该时段结束时，实体计数将重置为 0 以重新开始跟踪。

这种方法适用于大多数 API，但是对于调用 Xbox Live 的游戏和应用来说，这种方法不够灵活。 上述解决方案假设相关人员以一致、稳定且可预测的方式进行调用。 对于 Xbox Live，调用模式截然不同，具体取决于服务和请求的标题/应用。

在这种情况下，仅选择一项限制将要求在调用模式范围的两端进行取舍。 Xbox Live 解决方案使用两个时段和限制。 较小的时段称为“突增”时段，而较大、较长的时段则称为“持续”时段。 FGRL 的突增时段始终为 15 秒，而持续时段始终为 300 秒（5 分钟），因此在 5 分钟的持续时段内有 20 个突增时段。 系统将同时跟踪突增和持续限制，并同时跟踪计数请求。 为服务设置突增和持续限制意味着每项服务都拥有自己的突增和持续计数。 为了帮助你了解这两项限制如何协同工作，下表显示了正在玩游戏的用户，该游戏将对已实施 FGRL 的服务提出大量请求。 在此案例中，突增限制为在 15 秒内提出 30 次请求，而持续限制则为在 5 分钟内提出 100 次请求。

| 时间范围（秒）  | 每个突增时段的请求数  | 每个持续时段的请求数  | 在 15 秒间隔内限制的请求数 | 哪种限制？ （突增、持续或两者）  |
|-------------|--------------|----------------|-----------------------------------------------------|---------------------------|
| 0-15        | 35           | 35             | 5                                                   | 突增                     |
| 15-30       | 28           | 63             | 0                                                   | 不适用                       |
| 30-45       | 21           | 84             | 0                                                   | 不适用                       |
| 45-60       | 36           | 120            | 20                                                  | 两者                      |
| 60-75       | 24           | 144            | 24                                                  | 持续                   |
| …           | …            | …              |                                                     | …                         |
| 285-300     | 4            | 148            |                                                     | 持续                   |

该表显示在前 15 秒内用户通过提出 35 次请求触发了突增限制。 系统将删除这 5 次额外的请求，并发送 5 次 429 响应代码。 值得注意的是，尽管这 5 次请求受到限制，但它们仍将计入持续限制。 一旦触发任一限制（如下所示，在 45 秒处触发了两种限制并且在 285 秒处仅提出 4 次请求时再次触发），系统将不允许请求通过。

## <a name="http-429-response-object"></a>HTTP 429 响应对象

当关联的用户和作品计数达到或高于突增或持续限制时，服务将不会处理请求，而是返回 HTTP 429 响应代码。 HTTP 429 代码表示“请求过多”，它将随附一个标头，其中包含“请在 X 秒后重试”值。 FGRL 429 包含重试间隔标头，它指定了调用实体在重试之前应等待的时间。 使用 XSAPI 的开发人员不必担心，因为 XSAPI 会优先处理该重试间隔标头。 实际响应将包含以下字段：

| 字段名称      | 值类型 | 示例                | 定义                       |
|-----------------|------------|------------------------|----------------------------------|
| 版本         | 整型    | `"version":1`          |                                  |
| currentRequests | 整型    | `"currentRequests":13` | 已发送的请求总数    |
| maxRequests     | 整型    | `"maxRequests":10`     | 允许的请求总数 |
| periodInSeconds | 整型    | `“periodInSeconds”:15` | 时间窗口                      |
| 类型            | 字符串     | `“type”:”burst”`       | 节流限制类型              |

## <a name="implemented-limits"></a>已实施的限制

以下服务将实施 FGRL 限制，该限制将于** 2016 年 5 月开始实施**。 重申一点，在所有沙盒和作品中，这些限制都将保持不变。 **目前处于 XDP 或开发人员中心并在 2016 年 5 月前后发货的任何作品都将被视为旧版作品，因此将免受限制。** 以下限制尚未最终确定

| **服务名称**          | **突增限制（每个作品的每位用户 15 秒）** | **持续限制（每个作品的每位用户 300 秒）** |
|---------------------------|-------------------------------------------------|----------------------------------------------------|
| 游戏剪辑传输       | 50                                              | 300                                                |
| 游戏剪辑元数据       | 50                                              | 300                                                |
| 智能匹配（非 MPSD）    | 10                                              | 100                                                |
| 标题存储             | 30                                              | 300                                                |
| 统计数据读取（而非创建） | 100                                             | 300                                                |
| 成就读取         | 100                                             | 100                                                |
| 排行榜读取         | 30                                              | 100                                                |
| 个人资料                   | 10                                              | 30                                                 |
| 人脉                    | 10                                              | 30                                                 |
| 隐私                   | 10                                              | 30                                                 |
| 状态                  | 读取 10，写入 3                                | 读取 100，写入 30                                 |

上表显示了为 FGRL 选择的当前服务列表。 由于可以添加新服务和现有服务，此列表并非最终列表。 如果即将添加服务，该表将更新，并且会进行公告。 该表中显示的限制不应视为最终限制。 随着服务的更改和改进，限制也会随之改变，我们将会通知你并进行必要的旧版豁免。

## <a name="how-can-i-determine-i-am-being-throttled-and-what-steps-can-i-take"></a>如何确定我已受到限制以及可以采取哪些步骤？

请参阅 [Xbox Live 最佳实践](best-practices-for-calling-xbox-live.md) 文档，因为它包含用于改进调用模式的步骤，并且介绍了如何使用 XSAPI 断言、XSAPI 社交和多人游戏管理器以及动态跟踪工具来向你发出通知并减少限制问题。 你可以在 GDNP 和 SDK 以及 XDK docs 1602 及更高版本上找到最佳实践白皮书

## <a name="faq"></a>常见问题解答

### <a name="can-limits-change"></a>限制是否会发生更改？

设计意图是已发布的限制不会随时间推移而更改。 但是，如果有必要，则可能会让一些限制变得更严格；在这种情况下，已发布到 RETAIL 的作品将免受更新的限制。

### <a name="are-more-services-going-to-get-limits"></a>是否会限制更多服务？

是的，将为更多服务和新服务创建限制。 如同首次发布 FGRL 一样，你将会收到通知，并且需要采取适当的预防措施。

### <a name="when-will-these-changes-take-effect"></a>这些更改将在何时生效？

你将注意到 dev/cert 沙盒中的限制将从 4 月开始实施。 预计将于 5 月在 RETAIL 内实施限制

### <a name="what-if-we-cant-adhere-to-the-limits"></a>如果不遵守限制将会怎么样？

请参阅 [Xbox Live 最佳实践](best-practices-for-calling-xbox-live.md)，确保按照以下步骤操作。  此外请考虑使用[社交管理器](../../social-platform/intro-to-social-manager.md)（如果在社交服务上受到速率限制）。

如果在执行这些步骤后仍无法在限制条件下保持，请与你的开发人员客户经理联系。

### <a name="what-about-my-existing-title"></a>我的现有作品将如何？

在 RETAIL 中实施限制之前，位于 XDP 或开发人员中心的任何作品都将被视为旧版作品，并将免受限制。

### <a name="content-updates"></a>内容更新？

对于旧版或免受限制的游戏，内容更新也享有豁免权，但我们强烈建议你利用相关工具和资源来对游戏的服务集成方面进行优化。

### <a name="can-i-get-an-exemption-for-my-game-until-i-can-make-a-content-update"></a>在进行内容更新之前，我的游戏能否免除限制？

请与你的开发人员客户经理联系。

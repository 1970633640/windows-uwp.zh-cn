---
title: 高级 Xbox Live 沙盒
author: KevinAsgari
description: 了解如何以托管合作伙伴或 ID@Xbox 成员的身份使用 Xbox Live 沙盒来有效隔离相关内容。
ms.assetid: bd8a2c51-2434-4cfe-8601-76b08321a658
ms.author: kevinasg
ms.date: 04/04/2017
ms.topic: article
keywords: xbox live, xbox, 游戏, uwp, windows 10, xbox one
ms.localizationpriority: medium
ms.openlocfilehash: c414b7e95a81d1ac6307229c49b87072059d3a15
ms.sourcegitcommit: 144f5f127fc4fbd852f2f6780ef26054192d68fc
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/03/2018
ms.locfileid: "5982337"
---
# <a name="advanced-xbox-live-sandboxes"></a>高级 Xbox Live 沙盒

> **请注意** 本文将阐释沙盒的高级用法，它主要适用于拥有多个团队和复杂权限要求的大型游戏工作室。  如果你是 Xbox Live 创意者计划中的一员或 ID@Xbox 开发人员，建议你查看 [Xbox Live 沙盒简介](../xbox-live-sandboxes.md)

Xbox Live *沙盒*为开发提供了整个专用环境。 本文档将介绍什么是沙盒，它们存在的原因，如何适用于发布者，以及如何影响内部 Xbox 团队。 本文档面向的读者是生成 Xbox One 内容和使用沙盒的发布者。

## <a name="summary"></a>摘要

在 Xbox Live 中，只有一个生产环境，所有预发行版（开发版和 Beta 版）、证书以及零售内容均驻留在此环境中。

内容隔离可确保发布者内容不在生产中泄露。 在本质上，内容隔离可以确保任何请求资源访问权限的主体用户、设备或主题作品（主题作品或服务）都有权访问资源。 通过内容隔离，相应分区被划入存储主题作品或服务数据的沙盒中。 换个说法就是，在沙盒范围内定义授权策略。

沙盒是分隔生产中数据的一种方法。 使用 Xbox 360 era 服务时，PartnerNet 和 ProductionNet 是两种截然不同的环境。 对于 Xbox One 时代的服务，单个生产环境包含*n*不同的虚拟环境，其中每个虚拟环境称为一个沙盒。 由于所有内容都承载于单个生产环境中，所以沙盒实际上是独特的虚拟环境，而且在一个环境中生成的数据无法跨越到另一个环境。

下图展示了发布者可以在其中创建专用开发沙盒的单个生产环境。 仅授权开发人员帐户或开发人员工具包能够访问这些沙盒。

图 1. 生产环境中的沙盒。

![](../images/sandboxes/sandboxes_image1.png)

正如 PublisherA 拥有其开发沙盒一样，其他发布者也拥有其各自的开发沙盒。 同一个主题作品 ID 可能驻留在不同的沙盒中，但是沙盒内根据主题作品 ID 生成的数据是不同的。

有两种系统沙盒只能由 Microsoft 填充，即：CERT 和 RETAIL。 顾名思义，CERT 沙盒适用于在发行前进行认证的主题作品，而 RETAIL 沙盒是表示所有零售用户和设备均可访问的产生实际收入的沙盒。

之前在 Xbox Live 中主题作品 ID 是唯一的，而现在主题作品 ID 及沙盒 ID 是唯一的。 上述情况也适用于曾被视为唯一的产品 ID 和其他 ID 空间。 它们现在必须与沙盒 ID 配对。 将按照沙盒 ID 将 Xbox Live 中的所有数据在整个系统中进行分区。

## <a name="initial-setup-for-a-title"></a>主题作品的初始设置

主题作品源自于 Xbox 开发人员门户 (XDP) 或 Windows 开发人员中心。 为主题作品分配一个主题作品 ID、一个产品 ID 和一个服务配置 ID (SCID)。

在这个全新的世界里，主题作品或产品本身对 Xbox Live 来说没有任何意义。 因为我们必须支持单个主题作品的同步零售和开发，以及主题作品*实例化*，以做出并保持必要的区分。 主题作品实例驻留在沙盒中，这就是沙盒起作用的地方。

为创建主题作品，发布者将创建一个产品组，指定产品组的类型，然后在其中创建个人产品。 （有关更多详细信息，请参阅 XDP 文档。）下面的图表阐明了产品组、产品、产品实例以及沙盒之间的关系。

图 2. 产品组、产品、产品实例以及沙盒之间的关系。

![](../images/sandboxes/sandboxes_image2.png)

<a name="product-instances"></a>产品实例
-----------------

*产品实例*是对某一特定沙盒中的主题作品、产品和配置数据的一种投射。 此数据将从以下三方面进行描述：服务配置、目录源数据和二进制文件。

### <a name="service-configuration"></a>服务配置

> 服务配置定义（事件、统计数据、成就等）。 此服务配置是在产品实例级别定义的。

### <a name="catalog-metadata"></a>目录元数据

> 位于目录中的元数据包括销售文本、艺术资源、可用性/优惠信息、许可数据以及更多。

### <a name="binary"></a>二进制文件

> 二进制文件可以以下两种方式中的一种呈现：

1.  元数据仅用于启用旁加载。 包括内容 ID、版本信息及许可信息。

2.  整个二进制文件将被填充到 CDN，并且可供客户端下载。

<a name="getting-the-access-right"></a>获取访问权
------------------------

在 Xbox One 中，有两种不同的内容访问类型：

*设计时访问*—通过 XDP 工具从 PC 端访问—允许人们操作你的产品以上传、整理以及使用内容、配置和元数据，但不允许他们运行或操作产品实例。

*运行时访问*—从 Xbox 主机访问—允许开发人员、测试人员以及客户运行和操作产品实例。

**注意** 为了能够进行运行时访问，必须将产品实例置于沙盒中。 将生成的产品实例置于沙盒中后，有权访问该沙盒的 XDP 用户或开发人员工具包设备便可以运行该实例。 为此，他们通过 Xbox 主机使用其开发人员帐户登录 Xbox One—以虚拟用户身份运行的用于运行时访问的特殊帐户。

当我们谈及沙盒，我们通常都是在谈论对在 Xbox Live 上运行的内容的运行时访问。 访问 Xbox Live 中的服务时，需要主题作品 ID。 一旦 **appxmanifest** 包含主题作品 ID，主机就会将主题作品 ID 发送到 Xbox Live。 只有当相关主体（设备或用户）获得主题作品访问权限时，Xbox Live 安全服务才会返回有效的令牌。

此验证过程是内容隔离的关键。 从非常高的级别来看：

-   主体组可以包括 Xbox ID (XUID)、设备 ID、主题作品 ID 以及服务 ID。

-   沙盒可以包括主题作品 ID、产品 ID 或服务配置 ID (SCID)。

-   主体组有权访问沙盒。

因此，用户或设备若想访问沙盒中的预发行主题作品，则必须首先通过 XDP 获得访问权限。

图 3. 通过 XDP 设置访问权限的模型。

![](../images/sandboxes/sandboxes_image3.png)

内容隔离的有效性基于你的组织拥有以下流程这一事实：

-   创建 XDP 用户帐户，每个用户用来登录以进行运行时访问的开发人员帐户，以及均有成员资格的用户组成的用户组。

-   创建受信任主机的设备组。

-   针对每个开发沙盒进行精确指定，而用户组和设备组有权访问其中的产品实例。

此设置的示例在下图中进行了说明。

图 4. 未经授权的用户的凭据无法访问沙盒，授权的 XDP 用户帐户的普通凭据也是如此。 只有授权的 XDP 用户帐户所拥有的开发人员帐户凭据才能成功地对沙盒进行运行时访问，才能对该沙盒当前包含的所有产品实例进行访问。

![](../images/sandboxes/sandboxes_image4.png)

### <a name="dev-accounts-setup"></a>开发人员帐户设置

Xbox One 中的开发人员帐户就是应用了特殊规则的标准 Microsoft 帐户 (MSA)。 这些帐户在 Xbox Live 中用于开发。 开发人员帐户：

-   必须从 XDP 或 Windows 开发人员中心创建。

-   被分配外部开发人员角色（如果由发布者创建）。

-   绑定到创建了开发人员帐户的 XDP 帐户或 Windows 开发人员中心帐户。

-   只能登录到开发人员工具包。 不能在零售设备上登录到开发人员帐户。

-   可以免费购买 Xbox Live 开发人员金会员订阅或其他订阅以进行测试。

### <a name="user-group-setup"></a>用户组设置

用户组，即第一种主体组，是 XDP 用户的集合。 在将 XDP 用户添加到用户组后，这些 XDP 用户的开发人员帐户将随之流动。

因此，在将用户组分配到沙盒后，将与该用户组中的 XDP 用户关联的开发人员帐户添加到相应的主体组中，并使用设置回该沙盒的主要资源集为这些主体组设置策略。

**注意** 为访问沙盒而创建的用户组就是用于阻止访问产品组和产品的 XDP 中的配置数据的用户组。

### <a name="device-setup"></a>设备设置

也将设备添加到主体组。 如果通过游戏开发人员应用商店购买权利，并将设备预配为开发人员工具包，则该设备只能用作开发人员工具包。 设备一旦预配为开发人员工具包，就会显示在可添加到设备组的设备列表中。

### <a name="device-group-setup"></a>设备组设置

设备组，即第二种主体组，也可以获得沙盒访问权限。 其设置与上面详述的用户组设置类似。

## <a name="sandboxes"></a>沙盒

<a name="what-is-a-sandbox"></a>什么是沙盒？
------------------

简而言之，*沙盒是分隔生产中的数据的一种方法*。

<a name="why-do-we-need-sandboxes"></a>我们为什么需要沙盒？
-------------------------

正如用户和设备访问主题作品一样，主题作品可以访问服务。 我们引入了“主题作品组”的概念，其中，多组主题作品可获得服务资源的访问权限。

由于所有内容（预发行和零售）都由单个 Xbox One 生产环境承载，因此，必须阻止主题作品的多个实例（预发行/零售）在资源的相同实例上运行。

<a name="what-is-in-a-sandbox"></a>沙盒里有什么？
---------------------

沙盒包含添加到沙盒中的每个主题作品的产品实例。

<a name="what-is-a-sandbox-id"></a>什么是沙盒 ID？
---------------------

沙盒 ID 是作品、产品或服务配置数据的分隔单元。多个作品可以位于同一个沙盒中，这是这些作品可以共享任何服务配置数据的先决条件。

沙盒 ID （区分大小写） 是一个字符串采用以下格式： &lt;PublisherMoniker&gt;。*n*。 例如，沙盒 ID XLDP.5 的说明如下：

-   *发布者名字对象*在所有发布者中都是唯一的。 因此，“XLPD”是此特定发布者的发布者名字对象。 当开发人员帐户管理器在 XDP 中“激活”发布者时，将创建发布者名字对象。

-   数字 *“n”* 用于标识沙盒数。 在这种情况下，“5”代表的是为此发布者创建的第六个沙盒。

当主题作品数据在服务中移动时，Xbox 服务将使用沙盒 ID 为生成的数据唯一地标识“环境”。

<a name="what-data-is-sandboxed"></a>哪些数据可实现沙盒化？
-----------------------

下图显示了哪些用户和主题作品数据可实现沙盒化。

![](../images/sandboxes/sandboxes_image5.png)

<a name="global-override-sandbox"></a>全局替代沙盒
-----------------------

由于开发人员在开发人员工具包中设置沙盒 ID，因此，可以设置在其中运行该开发人员工具包的沙盒；这也称为全局替代沙盒。 因此，从开发人员工具包中的所有主题作品（shell 应用和常规应用）向 Xbox Live 服务（例如，成就、匹配、许可和 EDS 等）发出的所有请求都是在该沙盒中发出的。

全局替代沙盒还意味着，只有全局替代沙盒中引入的内容才在浏览时可见。

<a name="types-of-sandboxes"></a>沙盒类型
-------------------------------------------------------------------------------------------------------------------------------------------------------

有两种不同类别的沙盒。 这些类别的定义如下：

-   *发布者沙盒*。 发布者可访问其开发中的沙盒。 这些沙盒可能看起来像 XLDP.0、XLDP.1、XLDP.2、XLDP.3 等。这是发布者放置其主题作品产品实例的位置。 对于发布者向其授予访问权限的用户/设备来说，其对这些沙盒的访问受到限制。

-   *Microsoft 沙盒*。 这些是内置沙盒：RETAIL 和 CERT。只有 Microsoft 才能发布到这些受保护的沙盒。

<a name="cert-sandbox"></a>CERT 沙盒
------------

如果主题作品已准备好公开发行，则首先需要进行认证。 CERT 沙盒是 Microsoft 控制的沙盒，只有认证中的个人用户才能访问该沙盒。 发布者可以查看他们拥有的哪些内容将进行认证。

认证中的失败的产品实例可被召回至开发沙盒，由发布者使用 XDP 进行调试和修复。

<a name="retail-sandbox"></a>RETAIL 沙盒
--------------

RETAIL 沙盒是为 Xbox One 创建的所有内容的最终目的地。

主题作品在通过认证后，将添加到 RETAIL 沙盒中。 只有绿色签名内容才能在 RETAIL 沙盒中运行。 这暗示着发布者驱动的 Beta 版也是在 RETAIL 沙盒中完成的。 在 RETAIL 沙盒中生成的数据其实是客户生产数据。

请注意，你仍然可以通过内容隔离来控制对 RETAIL 沙盒中内容的访问权限。

例如，发布者驱动的 Beta 版在 RETAIL 沙盒中运行，其中，发布者可以选择哪些主体组有权访问发布者定义的 Beta 版资源集主题作品。 由 Beta 版主题作品生成的服务数据其实是生产数据，这些数据在主题作品公开发行后依然存在。

<a name="cross-sandbox-data-interaction"></a>跨沙盒数据交互
------------------------------

按照定义，沙盒是限制数据共享的容器。 因此，跨沙盒数据交互是不可能的。

## <a name="organizing-your-sandboxes"></a>组织你的沙盒

此部分提供了发布者如何组织沙盒的示例。 发布者需要了解如何使用沙盒组织数据。

**注意** 下面的示例仅说明了如何使用内容隔离管理运行时访问。

### <a name="scenario-1-two-titles-one-sandbox"></a>场景 1：两个主题作品、一个沙盒

对于发布者，基本结构可能是：

-   两个主题作品，可供发布者拥有的所有用户和设备进行设计时和运行时访问。

-   一个主题作品对应一个产品实例。

在这种情况下，发布者只需对所有预发行版内容使用单个沙盒即可。

下图显示了用户组。 发布者可以选择使用设备组而非用户组（如果更容易）。 另外，此用户组有权对沙盒 XLDP.1 和此沙盒中的主题作品进行运行时和设计时访问。

![](../images/sandboxes/sandboxes_image6.png)

### <a name="scenario-2-one-title-different-teams"></a>场景 2：一个主题作品、不同的团队

在这种模型中，要求如下：

-   一个主题作品。

-   开发人员团队负责每天生成版本。

-   QA 团队负责处理每周 LKG。

-   如果出现错误，开发人员团队需要调试每周 LKG。

-   财务团队需要访问与主题作品的目录发布有关的价格卡和其他元数据。

下图显示了 TitleX 有两个产品实例：PI-1 和 PI 2。 产品实例必须位于沙盒中，而且同一主题作品的两个产品实例不能位于同一个沙盒中。 因此，TitleX-PI-1 位于沙盒 XLDP.1 中，而 TitleX-PI-2 位于沙盒 XLDP.2 中。

开发人员用户组可以访问这两个沙盒，而 QA 用户组只能访问沙盒 XLDP.2。

此外，财务用户（组 C）可对 TitleX 进行设计时访问。 由于财务用户组通常不需要对主题作品执行任何运行时调试，因此会被分离出来。

**注意** 不论组织如何，XDP 用户都可以属于多个用户组。

![](../images/sandboxes/sandboxes_image7.png)

### <a name="scenario-3-two-titles-completely-separate"></a>场景 3：两个主题作品，完全独立

在此示例中，要求略有不同：

-   两个主题作品。

-   对每个主题作品的访问应限定于某些个人。

-   一个主题作品对应一个产品实例。

-   需要访问主题作品的设计时 XDP 配置数据的管理员用户组。 此组中的用户都是发布者的管理员，可以控制发布到目录（目录元数据、财务、营销、认证提交等）的所有数据。

在此模型中，发布者已选择使这两个主题作品完全保持独立，因而将这两个主题作品分配到两种不同的沙盒中。 发布者还选择了创建单独的管理员用户组，并分配了两个产品的访问权限。

![](../images/sandboxes/sandboxes_image8.png)

### <a name="scenario-4-anyway-you-like-it"></a>场景 4：只要你喜欢

由于连接数较多，因此，为了简单起见，我们选择了仅显示沙盒运行时连接。 你还可以自由添加其他设计时访问权限。

在此示例中，要求如下：

-   只有某些用户才能访问其发布者的某些主题作品。

-   发布者与来自不同公司的供应商合作。这些供应商可能是短期合作伙伴。

-   发布者应该能够解除主题作品授权，以此阻止访问供应商或 FTE 曾经可以访问的任何数据。

为了对此要求建模，可以采用如下结构。

该模型如下：

-   TitleX 和 TitleY 在沙盒 XLDP.1 中只能各有一个产品实例。

-   TitleZ 有两个产品实例，一个位于沙盒 XLDP.2 中，而另一个位于沙盒 XLDP.3 中。

-   FTE 用户组 B 可访问所有沙盒中的产品示例。

-   供应商用户组 A 是仅限供应商的用户组，可访问沙盒 XLDP.1。

-   供应商设备组 C 是仅限供应商的用户组，可访问沙盒 XLDP.3。

![](../images/sandboxes/sandboxes_image9.png)

## <a name="summary"></a>摘要

Xbox Live 开发为发布者提供了巨大的机会，让他们在生产中可以使用生产质量服务和生产 MSA 开发人员帐户进行测试。 为了提升功能和灵活性，需要执行 XDP 中的新配置步骤，以在开发和公开发行时创建主题作品数据，并管理对主题作品的访问。

沙盒是分隔生产中的数据的一种方法。 由于所有内容都由单个生产环境承载，因此，沙盒可以充当“虚拟环境”，在这种情况下，在一个环境中生成的数据无法跨越到另一个环境。

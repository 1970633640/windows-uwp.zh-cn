---
title: RTA 最佳实践
description: 了解使用 Xbox Live 实时活动服务的最佳实践。
ms.assetid: 543b78e3-d06b-4969-95db-2cb996a8bbd3
ms.date: 04/04/2017
ms.topic: article
keywords: xbox live, xbox, 游戏, uwp, windows 10, xbox one, 实时活动
ms.localizationpriority: medium
ms.openlocfilehash: 7733aab9330c316ad5938cf9a2ef763e06f19b9a
ms.sourcegitcommit: a3dc929858415b933943bba5aa7487ffa721899f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/07/2018
ms.locfileid: "8787135"
---
# <a name="real-time-activity-rta-best-practices"></a>实时活动 (RTA) 最佳实践
这些最佳实践将有助于你在作品中充分利用 RTA。


## <a name="the-basics"></a>基础知识

RTA 使用 WebSocket 会话创建与客户端的持续性连接。 这就是该服务为你提供统计数据的方式。 客户端需要发送经过身份验证的连接要求，而 RTA 将使用该请求中提供的标记，验证是否可以建立连接，然后建立该连接。

在连接建立后，你的应用可以发出订阅特定统计数据的请求。 在成功订阅后，RTA 将返回当前值和其他一些元数据，例如统计数据类型，作为响应有效负载的一部分。 然后，RTA 将会在订阅客户端时转发任何统计数据更新。

如果你的作品不需要统计信息的实时更新，则应终止对该统计数据的订阅。


## <a name="handling-disconnects"></a>处理断开连接

作品应了解，当用户的身份验证标记到期时，其会话将由该服务终止。 作品需要能够检测到出现此类事件的时间，然后重新连接，并重新订阅之前订阅的所有统计数据。

根据设计，将强制重新连接的客户端两个小时后关闭 RTA 连接。 这是因为连接的身份验证令牌缓存要保存在消息带宽。 最终令牌将会过期。 关闭连接并强制重新连接的客户端通过客户端将强制刷新身份验证令牌。

由于用户的 ISP 遇到问题，或者当作品的处理被暂停时，客户端可能也会断开连接。 如果发生这种情况，将触发 WebSocket 事件，以通知客户端。 一般情况下，最好是能够处理与该服务的断开连接。

> [!WARNING]
> 如果客户端使用 RTA 为多人游戏会话，并且断开连接时 30 秒，[多人游戏会话 Directory(MPSD)](../multiplayer/multiplayer-appendix/multiplayer-session-directory.md)检测到 RTA 会话已关闭，并且开始用户退出会话。 它是对 RTA 客户端以检测时关闭连接并启动重新连接并重新订阅之前 MPSD 结束会话。

## <a name="managing-subscriptions"></a>管理订阅

与标记到期时管理订阅相比，你的作品应随时跟踪所做的订阅。 在成功订阅后，RTA 为订阅的每项统计数据返回一个唯一标识符。 在未来对该统计数据进行的所有更新中，将使用该标识符来取代统计数据的名称。 这样做可以节省带宽。 客户端负责维护他们自己的将统计数据映射到 RTA 订阅 ID 的操作。


## <a name="unsubscribing"></a>取消订阅

不建议有未使用的订阅。 该服务限制了用户在给定时间可拥有每个作品的订阅数。 如果你要订阅任何内容，则可以达到该限制，但是，这样做可能使你无法订阅一些重要的统计数据。 （有关订阅限制的详细信息，请参阅本主题后面的**限制**）。

例如，你的作品可能只需订阅某个场景。 当用户进入该场景时，你的作品应该对其进行订阅。 当用户离开该场景时，应取消订阅这些统计数据。 同样，在不需要进行任何订阅时，可以使用“全部取消订阅”消息。

在取消订阅后，将不再使用该统计数据的订阅标识符。


## <a name="awareness-of-latent-items-in-the-queue"></a>感知队列中的潜在项目

如果取消订阅统计数据，在访问客户端的过程中，可能仍存在该统计数据的更新。 因此，你会发现，即使你的作品刚刚取消订阅统计数据，也可以获得一两项与该统计数据相关的更新。

建议在无法识别订阅标识符时忽略统计数据的更新。


## <a name="ignore-messages-you-do-not-understand"></a>忽略未知的消息

消息协议将有可能更新。 若要让你的应用与任何新消息无关，我们建议你的作品仅丢弃未知的消息类型。


## <a name="throttles"></a>限制

RTA 可对服务强制实施某些限制：

-   UserStats：1000
-   状态：2500

如果客户端达到限制，将会在订阅/取消订阅调用中收到错误消息，或者断开连接。 无论属于哪种情况，都将为客户端提供有关达到该限制的详细信息，以及错误消息或断开连接消息。

在开发你的作品时，请将这些概念牢记于心。 如果你做事情极端，则可能会影响应用体验，因为该服务可能会限制你的调用。 现在，该服务允许应用的每个实例订阅 1000 次统计数据。 除此之外，应用程序的实例还可以订阅用户的完整人脉列表，以获得状态更新。 该数字正在不断地调整，因此，它在以后的版本中可能会发生变化
